<!Doctype html>
<html>
    <head>
        <title></title>
        <meta charset = "UTF-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
        <link rel = "stylesheet" href = "style.css">
        <script src = "vue.js"></script>
    </head>
    <body>
        <div id = "app">
            <button onclick="notifyMe()">Notify me!</button>

            <button id = "buttonDailyTasks" @click = "showDailyTasks = true" v-on:click = "drawDailyTasks">Ежедневные задачи</button>
                <ul v-if = "showDailyTasks">
                    <li v-for = "(thisTask, taskIndex) in dailyTasks" class = "task">
                        
                            <div class = "dailyTaskBox">
                                <img class = "icon" src="icons/taskicon.svg">
                                <div class = "input dailyTask" :contenteditable = "thisTask.edit" ref = "taskInfoInput">{{ thisTask.taskInfo }}</div>
                            </div>
                            <div class = "dailyTaskTimeBox">
                                <img class = "icon" src = "icons/timeicon.svg">
                                <div class = "input dailyTaskTime" :contenteditable = "thisTask.edit" ref = "taskTimeInput">{{ thisTask.timeInfo }}</div>
                            </div>
                            <hr>
                            <div class = "dailyTaskIconsBox">
                                <div v-on:click = "deleteThisTask(taskIndex)" class = "deleteDailyTask dailyTaskIcon"></div>
                                <div v-on:click = "editThisTask(taskIndex, thisTask)" class = "editDailyTask dailyTaskIcon"></div>
                            </div>
                    </li>
                </ul>
            <div class = "buttonsMenu">
                <button class = "menuIcon" id = "buttonAddDailyTask" v-on:click = "addDailyTask"></button>
            </div>
        </div>
        
        
        
        <script>
            
            new Vue(
            {
                el:'#app',
                data:
                {
                    dailyTasks: 
                    [
                        {
                            taskInfo: "Типа инфа",
                            timeInfo: "Типа время",
                            edit: false
                        },
                        {
                            taskInfo: "Типа djjhskjsh",
                            timeInfo: "Типа kek",
                            edit: false
                        },
                        {
                            taskInfo: "Типа инфа",
                            timeInfo: "Типа время",
                            edit: false
                        }
                    ],
                    showDailyTasks: true,
                    deleteDailyTasks: false,
                    editDailyTasks: false
                },
                methods:
                {
                    drawDailyTasks()
                    {
                        console.log(JSON.parse(localStorage.getItem('dailyTasks')))
                        if (!JSON.parse(localStorage.getItem('dailyTasks')))
                            localStorage.setItem('dailyTasks', JSON.stringify(this.dailyTasks))
                        else
                        {
                            this.dailyTasks = JSON.parse(localStorage.getItem('dailyTasks'))
                        }
                    },
                    addDailyTask()
                    {
                        this.dailyTasks.push(
                        {
                            taskInfo: "Info",
                            timeInfo: "Time",
                            edit:false
                        })
                        localStorage.setItem('dailyTasks', JSON.stringify(this.dailyTasks))
                        console.log('Task added: \n')
                        console.log(JSON.parse(localStorage.getItem('dailyTasks')))
                    },
                    deleteThisTask(taskIndex)
                    {
                        this.dailyTasks.splice(taskIndex, 1)
                        localStorage.setItem('dailyTasks', JSON.stringify(this.dailyTasks))
                        console.log('Task deleted: \n')
                        console.log(JSON.parse(localStorage.getItem('dailyTasks')))
                    },
                    editThisTask(taskIndex, thisTask)
                    {
                        console.log('ok')
                        thisTask.edit = !thisTask.edit
                        if (thisTask.edit)
                            event.target.style.backgroundImage = 'url("icons/confirmicon.svg")'
                        else
                        {
                            event.target.style.backgroundImage = 'url("icons/editicon.svg")'
                            thisTask.taskInfo = this.$refs.taskInfoInput[taskIndex].innerHTML
                            thisTask.timeInfo = this.$refs.taskTimeInput[taskIndex].innerHTML
                        }
                        localStorage.setItem('dailyTasks', JSON.stringify(this.dailyTasks))
                        console.log('Task edited: \n') 
                        console.log(JSON.parse(localStorage.getItem('dailyTasks')))
                    }
                }
            })
            function notifyMe() {
                  // Проверка поддержки браузером уведомлений
                  if (!("Notification" in window)) {
                    alert("This browser does not support desktop notification");
                  }

                  // Проверка разрешения на отправку уведомлений
                  else if (Notification.permission === "granted") {
                    // Если разрешено, то создаем уведомление
                    var notification = new Notification("Hi there!");
                  }

                  // В противном случае, запрашиваем разрешение
                  else if (Notification.permission !== 'denied') {
                    Notification.requestPermission(function (permission) {
                      // Если пользователь разрешил, то создаем уведомление 
                      if (permission === "granted") {
                        var notification = new Notification("Hi there!");
                      }
                    });
                  }

                  // В конечном счете, если пользователь отказался от получения 
                  // уведомлений, то стоит уважать его выбор и не беспокоить его 
                  // по этому поводу.
                }
        </script>
    </body>
</html>
